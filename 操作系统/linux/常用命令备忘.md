## ssh 可以远程执行命令，设计通配符的时候需要使用单引号引起，例如

    for i in `cat grp`; do echo $i; ssh root@$i 'zcat /log/error.log.*.gz | grep DIFF| grep  "2018/08/29"' > $i.diff; done

## stderr重定向到stdio

全部输出到某个文件

    curl -vv www.baidu.com > baidu.log 2>&1

stderr不能直接grep,过度下

    curl -vv www.baidu.com 2>&1 | grep HTTP

## 快速生成大文件

fallocate 最好用的

没有的时候可以 dd 使用　seek，skip可以更快的建立一个空洞文件

    dd if=/dev/zero of=/tmp/test bs=1G count=6

## curl

### 指定访问ip

    curl --resolve www.baidu.com:443:127.0.0.1 https://www.baidu.com

### post

mutipart 上传文件

    curl -F "1111=@110055.body" https://www.baidu.com

url-encode 上传内容

    curl -d "param1=value1&param2=value2" "http://www.baidu.com"

## ssh -A

带上公钥，在登录的机器上可以使用ssh登录其他的机器，更新git库等

## 删除旧文件

    KEEP_DAYS=50
    find ${GZ_DIR} -mtime +${KEEP_DAYS} -name "*.log.gz" -exec  rm {} \;

+ find + xargs 也可以实现类似功能但是不安全，容易误删
+ 执行之前可以多用ls代替rm 测试几次再执行
+ 尽可能详细指定文件名模式，减少误删可能

## find 正则文件名称

+ -regex 只能正则
+ 写正则要包含路径内容，不是只有文件名
+ -regextype可以指定正则兼容性

例如：

    find ${TARGET_DIR} -regextype grep -regex '.*access-[0-9]\{10\}\.log\.gz'

## 参看json文件内容

+ 利用python


    cat test.json | python -m json.tool > format.json
    cat test.json | python -m json.tool | less


+ jq


    cat test.json | jq . > format.json
    cat test.json | jq . | less


> jq 支持更高级的用法，部分系统需要安装 `apt-get install jq`, 更详细参见man页面

## 建立软链接

    ln -s source target

## awk 常用技巧

例如有如下访问日志

    - 2018-09-05<SP>14:38:35 0.235 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /%E7%BC%96%E7%A8%8B GET - bypass - 301 886 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:38:31 0.242 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /%E6%9D%82%E6%96%87 GET - bypass - 301 886 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:38:33 0.244 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /%C3%A6%C2%9D%C2%82%C3%A6%C2%96%C2%87/ GET - miss - 404 6015 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:38:39 0.232 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /%E7%BC%96%E7%A8%8B/go/ping-pong%E6%B5%8B%E8%AF%95%E5%A4%87%E5%BF%98.html GET - miss - 200 3574 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:38:27 0.485 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /robots.txt GET - bypass - 404 10100 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:38:29 0.267 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98.html GET - miss - 200 6812 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:38:37 0.240 NONE - 85.10.199.185 85.10.199.185 - www.zhaoch.top /%C3%A7%C2%BC%C2%96%C3%A7%C2%A8%C2%8B/ GET - miss - 404 6016 - Mozilla/5.0<SP>(compatible;<SP>MJ12bot/v1.4.8;<SP>http://mj12bot.com/) - - - - - - - -
    - 2018-09-05<SP>14:57:32 0.005 NONE - 93.158.161.10 93.158.161.10 - www.zhaoch.top /robots.txt GET - bypass - 404 10100 - Mozilla/5.0<SP>(compatible;<SP>YandexBot/3.0;<SP>+http://yandex.com/bots) - - - - - - - -
    - 2018-09-05<SP>14:57:36 0.233 NONE - 93.158.161.10 93.158.161.10 - www.zhaoch.top / GET - miss - 200 2692 - Mozilla/5.0<SP>(compatible;<SP>YandexBot/3.0;<SP>+http://yandex.com/bots) - - - - - - - -

### 打印某些字段

    cat log| awk '{print $6" accessed https://"$9""$10}'

    85.10.199.185 accessed https://www.zhaoch.top/%E7%BC%96%E7%A8%8B
    85.10.199.185 accessed https://www.zhaoch.top/%E6%9D%82%E6%96%87
    85.10.199.185 accessed https://www.zhaoch.top/%C3%A6%C2%9D%C2%82%C3%A6%C2%96%C2%87/
    85.10.199.185 accessed https://www.zhaoch.top/%E7%BC%96%E7%A8%8B/go/ping-pong%E6%B5%8B%E8%AF%95%E5%A4%87%E5%BF%98.html
    85.10.199.185 accessed https://www.zhaoch.top/robots.txt
    85.10.199.185 accessed https://www.zhaoch.top/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98.html
    85.10.199.185 accessed https://www.zhaoch.top/%C3%A7%C2%BC%C2%96%C3%A7%C2%A8%C2%8B/
    93.158.161.10 accessed https://www.zhaoch.top/robots.txt
    93.158.161.10 accessed https://www.zhaoch.top/


### 条件打印

    cat log| awk '{if ($10=="/robots.txt")print $6" accessed https://"$9""$10}'

    85.10.199.185 accessed https://www.zhaoch.top/robots.txt
    93.158.161.10 accessed https://www.zhaoch.top/robots.txt

### 分类统计

    cat log| awk '{arr[$6] += 1}END{for(i in arr)print i"\t"arr[i]}' 

    85.10.199.185	7
    93.158.161.10	2

### 某个字段出现的次数

    cat log| awk '{print $6}' | sort | uniq -c | sort -n

    2 93.158.161.10
    7 85.10.199.185
