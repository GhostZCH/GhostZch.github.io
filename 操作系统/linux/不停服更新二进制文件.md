## 不停服更新二进制文件

虽然目前分布式架构和keepalived等工具的存在，对于某些特殊的程序，仍然需要不停服更新二进制文件。
这里介绍下nginx如何实现这个功能的

### 痛点

+ 已有的链接不中断，直至这个客户端关闭链接
+ 使用新的程序文件处理新的请求
+ 新老进程同时存在还要监听相同的端口

### 思路

+ 因为要监听相同端口所以一般都是父子进程
+ 常用的fork不能更新二进制文件，需要通过exec
+ 监听相同端口可以通过把句柄作为参数或者环境变量传递给子进程

### 过程

+ 向主进程发送USR2信号
+ 设置本地变量，老进程不再accept新的连接，已有的连接正常处理，直至业务完成
+ 通过exec函数启动子进程，将listen的句柄通过参数或者环境变量传给子进程
+ 子进程开始listen并accept的，新接入的连接由新程序处理
+ 老程序持续运行，直至所有的连接都完成业务（可设置超时时间），退出
+ 此时只有子程序在运行

### 示例代码

TODO
